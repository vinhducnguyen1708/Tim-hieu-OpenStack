# Hướng dẫn cài đặt driver NVIDIA cho OS và Hypervisor KVM

### Thông tin:
- Máy chủ SuperMicro
- OS: CentOS 8
- Hypervisor: KVM - qemu-kvm-5.2.0-16.el8.x86_64
- GPU: NVIDIA Tesla T4 16GB x1

## I. Disable Nouveau
- **Bước 1:** Kiểm tra trạng thái nouveau, nếu có output tức là đang enable
```sh
lsmod | grep nouveau
```

- **Bước 2:** Cấu hình disable nouveau
```sh
cat << EOF >/etc/modprobe.d/nvidia-installer-disable-nouveau.conf
# generated by nvidia-installer
blacklist nouveau
options nouveau modeset=0
EOF
```
- **Bước 3:** Khởi tạo lại kernel initramfs
```sh
sudo dracut --force
```
- **Bước 4:** Khởi động lại máy chủ
```sh
init 6
```
## II. Cài đặt driver NVIDIA cho OS

- **Bước 1:** Kiểm tra card GPU NVIDIA đã được cắm vào máy chủ
```sh
lspci | grep -i nvidia
```
- **Bước 2:** Cài đặt các gói cần thiết
```sh
yum -y install elfutils-libelf-devel pkg-config libglvnd make gcc pciutils
```
- **Bước 3:** Cài đặt kernel-devel, yêu cầu cần phải đúng với phiên bản kernel của OS(nếu package kernel-devel phiên bản đó không còn tồn tại thì cài đặt không chỉ định phiên bản rồi reboot lại máy)
```sh
sudo yum -y install kernel-devel-$(uname -r) kernel-headers-$(uname -r)
```
***! Lưu ý !:*** *nếu package kernel-devel phiên bản đó không còn tồn tại thì cài đặt không chỉ định phiên bản rồi reboot lại máy*
```sh
# Cài đặt kernel-devel mà hiện tại repo cung cấp
sudo yum -y install kernel-devel

# Khởi động lại máy chủ
reboot
```

